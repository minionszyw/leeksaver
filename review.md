# 数据层审查报告

**审查日期**: 2025-12-26
**审查人**: System Administrator

## 1. 审查概览

本次审查针对 `LeekSaver` 项目的核心数据表进行了完整性、覆盖率和时效性的全面检查。审查发现数据库中存在严重的**数据缺失**和**覆盖率不足**问题，部分核心功能模块（如基本面分析、技术分析）可能因此无法正常工作。

## 2. 审查项详细说明

### 2.1 基础数据 (Stocks & Sectors)
*   **状态**: ⚠️ **严重缺失元数据**
*   **标的分布**: 共有 6790 只活跃标的。其中 **股票 (Stock) 5465 只**，**ETF 1325 只**。标的数量级符合 A 股市场实际水平。
*   **问题**: 
    *   ❌ **行业缺失**: `industry` 字段 100% 为空 (6790/6790 NULLs)。导致基于行业的选股和板块分析功能不可用。
    *   ❌ **日期缺失**: `list_date` (上市日期) 统计显示没有任何有效数据。

### 2.2 行情数据 (Quotes)
*   **状态**: ❌ **严重覆盖空洞**
*   **Daily Quotes**: 总计 259 万条记录。
    *   ❌ **致命覆盖率问题**: 今日 (2025-12-26) 仅有 **6** 只股票有行情数据 (占比 0.1%)。
    *   ❌ **下游连锁反应**: 由于行情缺失，今日生成的 **技术指标 (Tech Indicators)** 也仅有 **6** 条记录。技术分析模块处于基本不可用状态。

### 2.3 财务与基本面 (Financials & Valuations)
*   **状态**: ⚠️ **混合状态**
*   **Financial Statements**: ❌ **几乎空白** (仅 24 条记录)。
*   **Daily Valuations**: ✅ **相对稳健**。今日覆盖 **5471** 只股票 (80.6%)。这证明系统有能力大规模同步数据，行情数据的缺失更可能是同步器内部逻辑或配置问题。

### 2.4 资金与情绪 (Flows & Sentiment)
*   **状态**: ⚠️ **部分缺失**
*   **资金流**: 北向资金、主力流向 (Top 100)、龙虎榜今日已正常更新。
*   **缺失项**: **两融数据 (Margin Trade)** 与 **市场情绪 (Market Sentiment)** 表依然为空 (0 记录)。

### 2.5 宏观与资讯
*   **News**: ⚠️ **采集量异常**
    *   今日全市场新闻仅采集到 **5** 条（来自 5 个不同源）。对于全市场采集任务，该数量级显著偏低，可能存在采集频率过低或去重策略过严的问题。
*   **Macro**: ❌ **空白** (0 记录)。

## 3. 问题汇总与风险评估

| 优先级 | 问题描述 | 影响范围 | 潜在原因 |
| :--- | :--- | :--- | :--- |
| **P0** | **日线行情覆盖率 0.1%** | K线、技术分析、选股策略 | 同步器异常中断；限流导致大面积失败。 |
| **P0** | **股票元数据 100% 缺失** | 行业板块关联、打新分析 | 基础同步任务 `sync_stock_list` 字段映射失效。 |
| **P0** | **全市场财报缺失** | 基本面分析、PE/PB 准确性 | 缺少历史数据回溯 (Backfill) 机制。 |
| **P1** | **新闻采集量级异常** | 市场热点监控、情感分析 | `news_sync_market_limit` 设置过小或接口封禁。 |

## 4. 建议方案 (稳健性治理)

### 4.1 核心同步机制重构 (事前防御)
*   **细粒度容错**: 修改同步循环，确保单只股票失败不中断整个批次，异常记录至 `sync_errors` 表。
*   **Schema 强校验**: 引入 Pydantic 校验，确保 `industry` 等关键字段在入库前非空，否则立即上报告警。

### 4.2 数据补录与恢复 (事中处理)
*   **启动 Backfill 任务**: 针对财务报表和日线行情，开发专项补录工具，按月/季度分片回溯过去 3 年的历史数据。

### 4.3 建立“数据医生”监控体系 (事后发现)
*   **自动化巡检**: 开发 `data_doctor.py` 脚本，每日 09:00 定时统计：
    1.  **覆盖率**: 昨日行情覆盖率必须 > 95%。
    2.  **新鲜度**: 检查关键表（如估值、情绪）的 `max(trade_date)` 是否为最新交易日。
    3.  **完整性**: 扫描 `stocks` 表中 `industry` 为空的比例。
*   **告警通知**: 巡检失败通过日志即时推送给执行者。

> **结论**: “数据医生”是解决现有问题的**最快发现手段**，但要实现真正的稳健性，必须配合**同步机制的容错重构**，实现“监控发现-自动重试-手动补录”的闭环。